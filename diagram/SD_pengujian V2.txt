@startuml
hide footbox
title Proses Pengujian\n

actor Peneliti
boundary UI
control Ekspresi_wajah
control Render_template
entity Database
control Deteksi_wajah
control OpenCV
control Praproses

activate Ekspresi_wajah
ref over Ekspresi_wajah, Praproses : Proses Pelatihan

activate Peneliti
Peneliti -> UI : uji()
activate UI
UI -> Ekspresi_wajah : pengujian1()


	Ekspresi_wajah -> Database : select_data_uji()
	activate Database
	Database --> Ekspresi_wajah : data
	deactivate Database

	loop for i in range(jumlah_data)

		Ekspresi_wajah -> Ekspresi_wajah : uji_ciri_sendiri(id_file, path, nama_file)
		activate Ekspresi_wajah

		Ekspresi_wajah -> Deteksi_wajah : resize_image(image, nama_file, 'uji', 'uji')
		activate Deteksi_wajah
		Deteksi_wajah --> Ekspresi_wajah : path
		deactivate Deteksi_wajah

		Ekspresi_wajah -> OpenCV : deteksi(path)
		activate OpenCV
		OpenCV --> Ekspresi_wajah : faces, img
		deactivate OpenCV

		Ekspresi_wajah -> Database : select_ciri('ciri_pelatihan', 'S')
		activate Database
		Database --> Ekspresi_wajah : kumpulan_ciri

		Ekspresi_wajah -> Database : select_kelas('ciri_pelatihan', 'S')
		Database --> Ekspresi_wajah : kumpulan_kelas

		loop for kelas_s in kumpulan_kelas_s
			Ekspresi_wajah -> Database : select_avg('ciri_pelatihan', kelas_s)
			Database --> Ekspresi_wajah : data_rata_rata
			deactivate Database
		end

		

		loop for i, f in enumerate(faces)
			Ekspresi_wajah -> Praproses : biner(path_wajah)
			activate Praproses
			Praproses --> Ekspresi_wajah : img_biner
			deactivate Praproses

			create control GMI
			Ekspresi_wajah -> GMI : <<GMI(sub_face)>>
			activate GMI
			Ekspresi_wajah -> GMI : hitungMomenNormalisasi()
			Ekspresi_wajah -> GMI : hitungCiri()
			GMI --> Ekspresi_wajah : ciri
			deactivate GMI

			create control Klasifikasi
			Ekspresi_wajah -> Klasifikasi : <<Klasifikasi(kumpulan_ciri_s, kumpulan_kelas_s)>>
			activate Klasifikasi
			Ekspresi_wajah -> Klasifikasi : classify([ciri])
			Klasifikasi --> Ekspresi_wajah : ekspresi
			deactivate Klasifikasi

			Ekspresi_wajah -> Database : insert_ciri('ciri_pengujian', ciri, 'S')
			activate Database
			Ekspresi_wajah -> Database : select_first_row()
			Database --> Ekspresi_wajah : data
			Ekspresi_wajah -> Database : insert_pengujian(data_pengujian)
			Ekspresi_wajah -> Database : select_pengujian_first_row()
			Database --> Ekspresi_wajah : data_pengujian
			deactivate Database

		
			loop for i in range(7)
				Ekspresi_wajah -> Ekspresi_wajah : hitung_jarak(ciri[i], rata_rata_ciri_s['bahagia'][i]])
				activate Ekspresi_wajah
				Ekspresi_wajah --> Ekspresi_wajah : data
				deactivate Ekspresi_wajah
				Ekspresi_wajah -> Ekspresi_wajah : hitung_jarak(ciri[i], rata_rata_ciri_s['sedih'][i]])
				activate Ekspresi_wajah
				Ekspresi_wajah --> Ekspresi_wajah : data
				deactivate Ekspresi_wajah
				Ekspresi_wajah -> Ekspresi_wajah : hitung_jarak(ciri[i], rata_rata_ciri_s['marah'][i]])
				activate Ekspresi_wajah
				Ekspresi_wajah --> Ekspresi_wajah : data
				deactivate Ekspresi_wajah
				Ekspresi_wajah -> Ekspresi_wajah : hitung_jarak(ciri[i], rata_rata_ciri_s['jijik'][i]])
				activate Ekspresi_wajah
				Ekspresi_wajah --> Ekspresi_wajah : data
				deactivate Ekspresi_wajah
				Ekspresi_wajah -> Ekspresi_wajah : hitung_jarak(ciri[i], rata_rata_ciri_s['kaget'][i]])
				activate Ekspresi_wajah
				Ekspresi_wajah --> Ekspresi_wajah : data
				deactivate Ekspresi_wajah
				Ekspresi_wajah -> Ekspresi_wajah : hitung_jarak(ciri[i], rata_rata_ciri_s['takut'][i]])
				activate Ekspresi_wajah
				Ekspresi_wajah --> Ekspresi_wajah : data
				deactivate Ekspresi_wajah
				Ekspresi_wajah -> Ekspresi_wajah : hitung_jarak(ciri[i], rata_rata_ciri_s['natural'][i]])
				activate Ekspresi_wajah
				Ekspresi_wajah --> Ekspresi_wajah : data
				deactivate Ekspresi_wajah
			end

			loop for s in range(7)
				Ekspresi_wajah -> Database : insert_jarak_ciri(id_ciri_pengujian_s, kumpulan_ekspresi[i], kumpulan_jarak[i])
				activate Database
				deactivate Database
			end
		end


		Ekspresi_wajah -> Database : select_hasil('hasil_sendiri', id_file, waktu_s)
		activate Database
		Database --> Ekspresi_wajah : data_hasil
		Ekspresi_wajah -> Database : insert_hasil(hasil_all_s)
		deactivate Database

		Ekspresi_wajah --> Ekspresi_wajah :file_name_s, jarak_all_s, directory, hasil_all_s, id_pengujian_update

	
		ref over Ekspresi_wajah, Praproses : Uji Ciri Hasil OpenCV
		
		deactivate Deteksi_wajah
		deactivate Ekspresi_wajah
	
	end
@enduml


